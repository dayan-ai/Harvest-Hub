<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Checkout - Harvest HUB</title>

    <link rel="stylesheet" href="{{ url_for('static', filename='css/first.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css">

    <style>
        /* =========================================
           CHECKOUT PAGE SPECIFIC STYLES
        ========================================== */
        
        /* Layout Adjustments */
        .home { margin-bottom: 20px; }
        .checkout-container { max-width: 1200px; margin: 40px auto; display: flex; gap: 30px; padding: 0 20px; }
        .form-container { flex: 2; background: #fff; padding: 30px; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); }
        .summary-container { flex: 1; background: #f9f9f9; padding: 30px; border-radius: 10px; height: fit-content; border: 1px solid #eee; }

        /* Harvest Hub Theme Colors Override */
        .btn-primary {
            background-color: #81c408 !important;
            border-color: #81c408 !important;
            padding: 12px;
            font-weight: bold;
            font-size: 1.1rem;
            border-radius: 30px;
        }
        .btn-primary:hover {
            background-color: #6a9e08 !important;
        }

        .form-control:focus {
            border-color: #81c408 !important;
            box-shadow: 0 0 5px rgba(129, 196, 8, 0.5) !important;
        }

        /* Headings */
        h2, h5 {
            color: #333;
            border-left: 5px solid #81c408;
            padding-left: 15px;
            margin-bottom: 20px;
        }

        /* Payment Forms (Hidden by default) */
        .credit-form {
            border-left: 5px solid #81c408 !important;
            background: #f8fff0;
            padding: 15px;
            margin-top: 10px;
            display: none; /* Controlled by JS */
        }
        
        .payment-options label {
            margin-right: 15px;
            font-weight: 500;
            cursor: pointer;
        }

        /* Summary Table */
        .checkout-table { width: 100%; font-size: 0.9rem; }
        .checkout-table th { text-align: left; color: #777; padding-bottom: 10px; }
        .checkout-table td { padding: 8px 0; border-bottom: 1px solid #eee; }
        .grand-total { font-size: 1.2rem; font-weight: bold; color: #81c408; }

        /* Responsive Design */
        @media (max-width: 768px) {
            .checkout-container { flex-direction: column-reverse; }
        }
    </style>
</head>

<body>

    <div class="top">
        <i class="fa-solid fa-location-dot"></i>
        <p class="street">123 Street, New York</p>
        <i class="fa-solid fa-envelope"></i>
        <p class="street">Email@gmail.com</p>
    </div>

    <div class="home">
        <p class="fruits">Harvest HUB</p>
        <div class="hm">
            <a href="/">Home</a>
            <a href="/shop">Shop</a>
            <a href="/details">Shop Details</a>
            <a href="/contact">Contacts</a>
        </div>
        <div class="search">
            <a href="/shop"><i class="fa-solid fa-magnifying-glass"></i></a>
            <a href="/cart"><i class="fa-solid fa-bag-shopping"></i></a>
            <a href="/dashboard" style="color: inherit;"><i class="fa-solid fa-user"></i></a>
        </div>
    </div>
    <div class="checkout-container">
        
        <div class="form-container">
            <h2>Billing Information</h2>
            <form id="checkout-form" action="/place-order" method="POST">
                
                <div class="mb-3">
                    <label class="form-label">Full Name</label>
                    <input type="text" name="name" class="form-control" placeholder="Enter your full name" required />
                </div>
                <div class="mb-3">
                    <label class="form-label">Email Address</label>
                    <input type="email" name="email" class="form-control" placeholder="Enter your email" required />
                </div>
                
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label class="form-label">Our Support Number</label>
                        <input type="text" class="form-control" value="0312-4800449" readonly style="background-color: #e9ecef; cursor: not-allowed;" />
                    </div>
                    <div class="col-md-6 mb-3">
                        <label class="form-label">Your Contact Number</label>
                        <input type="text" name="phone" class="form-control" placeholder="03XX-XXXXXXX" required />
                    </div>
                </div>

                <div class="mb-3">
                    <label class="form-label">Shipping Address</label>
                    <textarea name="address" class="form-control" rows="2" placeholder="House No, Street, City..." required></textarea>
                </div>

                <h5 class="mt-4">Payment Method</h5>
                <div class="payment-options mb-3">
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="radio" name="payment" id="cod" value="cod" checked>
                        <label class="form-check-label" for="cod">Cash on Delivery</label>
                    </div>
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="radio" name="payment" id="easypaisa" value="easypaisa">
                        <label class="form-check-label" for="easypaisa">Easypaisa</label>
                    </div>
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="radio" name="payment" id="jazzcash" value="jazzcash">
                        <label class="form-check-label" for="jazzcash">JazzCash</label>
                    </div>
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="radio" name="payment" id="bank" value="bank">
                        <label class="form-check-label" for="bank">Bank Transfer</label>
                    </div>
                </div>

                <div class="credit-form" id="easypaisa-form">
                    <div class="mb-3">
                        <label class="form-label">Easypaisa Account Number</label>
                        <input type="text" class="form-control" id="easypaisaNumber" placeholder="03XXXXXXXXX" />
                        <p class="small text-muted mt-1"><i class="fa-solid fa-circle-info"></i> Please send amount to: <strong>0312-4800449</strong></p>
                    </div>
                </div>

                <div class="credit-form" id="jazzcash-form">
                    <div class="mb-3">
                        <label class="form-label">JazzCash Account Number</label>
                        <input type="text" class="form-control" id="jazzcashNumber" placeholder="03XXXXXXXXX" />
                        <p class="small text-muted mt-1"><i class="fa-solid fa-circle-info"></i> Please send amount to: <strong>0300-1234567</strong></p>
                    </div>
                </div>

                <div class="credit-form" id="bank-form">
                    <div class="mb-3">
                        <label class="form-label">Sender Account Number</label>
                        <input type="text" class="form-control" id="bankNumber" placeholder="Enter Account No" />
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Sender CNIC (Optional)</label>
                        <input type="text" class="form-control" id="bankCnic" placeholder="CNIC Number" />
                    </div>
                    <p class="small text-muted"><i class="fa-solid fa-building-columns"></i> Bank: <strong>HBL</strong> | Title: <strong>Harvest Hub</strong> | Acc: <strong>1234-5678</strong></p>
                </div>

                <input type="hidden" name="cart_data" id="cart_data">

                <div class="alert alert-success mt-4">
                    <strong>Total Payable: $<span id="payable">0.00</span></strong>
                </div>

                <button type="submit" class="btn btn-primary w-100">Place Order Now</button>
            </form>
        </div>

        <div class="summary-container">
            <h2><i class="fa-solid fa-cart-shopping"></i> Your Order</h2>
            <table class="checkout-table">
                <thead>
                    <tr>
                        <th>Product</th>
                        <th>Name</th>
                        <th>Qty</th>
                        <th>Total</th>
                    </tr>
                </thead>
                <tbody id="checkout-body">
                    </tbody>
            </table>
            
            <div style="margin-top: 20px; border-top: 2px solid #ddd; padding-top: 15px;">
                <div class="d-flex justify-content-between mb-2">
                    <span>Subtotal:</span>
                    <span>$<span id="checkout-subtotal">0.00</span></span>
                </div>
                <div class="d-flex justify-content-between mb-2">
                    <span>Tax (10%):</span>
                    <span>$<span id="checkout-tax">0.00</span></span>
                </div>
                <div class="d-flex justify-content-between mt-3">
                    <span class="grand-total">Total:</span>
                    <span class="grand-total">$<span id="checkout-total">0.00</span></span>
                </div>
            </div>
        </div>
    </div>
    <footer class="footer">
        <div class="footer-top">
            <div class="footer-logo">
                Harvest HUB
                <span>Fresh products</span>
            </div>
            <form class="footer-form" onsubmit="event.preventDefault(); alert('Subscribed!')">
                <input type="email" placeholder="Your Email" required />
                <button type="submit">Subscribe Now</button>
            </form>
            <div class="social-icons">
                <a href="#">t</a>
                <a href="#">f</a>
                <a href="#">▶</a>
                <a href="#">in</a>
            </div>
        </div>

        <div class="footer-columns">
            <div class="footer-column" style="flex: 1">
                <h3>Why People Like us!</h3>
                <p>Customers love us for our fresh, high-quality produce, reliable delivery, and exceptional customer service.</p>
            </div>

            <div class="footer-column" style="flex: 1">
                <h3>Shop Info</h3>
                <a href="/about">About Us</a><br />
                <a href="/contact">Contact Us</a><br />
                <a href="/about">Privacy Policy</a><br />
                <a href="/about">Terms & Condition</a><br />
                <a href="/about">Return Policy</a><br />
                <a href="/about">FAQs & Help</a>
            </div>

            <div class="footer-column" style="flex: 1">
                <h3>Account</h3>
                <a href="/coming-soon">My Account</a><br />
                <a href="/details">Shop details</a><br />
                <a href="/cart">Shopping Cart</a><br />
                <a href="/coming-soon">Wishlist</a><br />
                <a href="/coming-soon">Order History</a><br />
                <a href="/coming-soon">International Orders</a>
            </div>

            <div class="footer-column" style="flex: 1">
                <h3>Contact</h3>
                <p>Address: 1429 Netus Rd, NY 48247</p>
                <p>Email: Example@gmail.com</p>
                <p>Phone: +0123 4567 8910</p>
                <p>Payment Accepted</p>
                <div class="payment-icons">
                    <img src="https://img.icons8.com/color/48/visa.png" alt="Visa" />
                    <img src="https://img.icons8.com/color/48/mastercard.png" alt="Mastercard" />
                    <img src="https://img.icons8.com/color/48/maestro.png" alt="Maestro" />
                    <img src="https://img.icons8.com/color/48/paypal.png" alt="Paypal" />
                </div>
            </div>
        </div>

        <div class="footer-bottom">
            <span>© <span class="highlight">Harvest HUB</span>, All right reserved.</span><br>
        </div>
    </footer>
    <script>
        // 1. Load Data from LocalStorage
        const selectedItems = JSON.parse(localStorage.getItem("selectedItems")) || [];
        const tbody = document.getElementById("checkout-body");

        // Redirect if cart is empty
        if (selectedItems.length === 0) {
            tbody.innerHTML = "<tr><td colspan='4' class='text-center'>Cart is empty! <br><a href='/shop' class='btn btn-sm btn-success mt-2'>Go Shopping</a></td></tr>";
        }

        let subtotal = 0;

        // 2. Populate Order Summary Table
        selectedItems.forEach(item => {
            const tr = document.createElement("tr");
            const total = item.qty * item.price;
            subtotal += total;
            
            tr.innerHTML = `
                <td><img src="/static/images/${item.image}" alt="${item.name}" width="50" style="border-radius:5px;"></td>
                <td>${item.name}</td>
                <td>x${item.qty}</td>
                <td>$${total.toFixed(2)}</td>
            `;
            tbody.appendChild(tr);
        });

        // 3. Calculate Totals (Tax & Grand Total)
        const tax = subtotal * 0.10;
        const grandTotal = subtotal + tax;

        document.getElementById("checkout-subtotal").textContent = subtotal.toFixed(2);
        document.getElementById("checkout-tax").textContent = tax.toFixed(2);
        document.getElementById("checkout-total").textContent = grandTotal.toFixed(2);
        document.getElementById("payable").textContent = grandTotal.toFixed(2);

        // 4. Payment Method Toggle Logic
        const formSections = {
            easypaisa: document.getElementById("easypaisa-form"),
            jazzcash: document.getElementById("jazzcash-form"),
            bank: document.getElementById("bank-form")
        };

        function hideAllPaymentForms() {
            Object.values(formSections).forEach(section => section.style.display = "none");
        }

        document.querySelectorAll('input[name="payment"]').forEach(radio => {
            radio.addEventListener('change', () => {
                hideAllPaymentForms();
                if (formSections[radio.value]) {
                    formSections[radio.value].style.display = 'block';
                }
            });
        });

        // Initial check to hide/show based on default selection
        hideAllPaymentForms();

        // 5. Submit Handler (Preparing Data for Backend)
        document.getElementById("checkout-form").addEventListener("submit", function (e) {
            if (selectedItems.length === 0) {
                e.preventDefault();
                alert("Your cart is empty!");
                return;
            }
            
            // Populate hidden input with JSON data
            document.getElementById("cart_data").value = JSON.stringify(selectedItems);
            
            // Note: LocalStorage clearing should ideally happen on the "Thank You" page or after successful response
            // localStorage.removeItem("selectedItems"); 
        });
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>